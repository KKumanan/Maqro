(()=>{"use strict";const e={apiEndpoint:"http://localhost:3000/api/events",isCollecting:!0};chrome.runtime.onInstalled.addListener((()=>{console.log("Maqro: Extension installed")})),chrome.runtime.onMessage.addListener(((o,t,n)=>{var s;console.log("Maqro: Received message",o),"USER_EVENT"===o.type&&o.event?async function(o){if(e.isCollecting)try{console.log("Maqro: Sending event to API",o);const t=await fetch(e.apiEndpoint,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({events:[o]})});if(!t.ok)throw new Error(`API responded with status: ${t.status}`);const n=await t.json();console.log("Maqro: Event sent successfully",n)}catch(e){console.error("Maqro: Error sending event",e)}else console.log("Maqro: Event collection is paused")}(o.event):"TOGGLE_COLLECTION"===o.type&&(e.isCollecting=null!==(s=o.enabled)&&void 0!==s&&s,console.log("Maqro: Collection state changed to",e.isCollecting),n({success:!0}))})),chrome.tabs.onUpdated.addListener(((o,t,n)=>{var s;"complete"===t.status&&(null===(s=n.url)||void 0===s?void 0:s.startsWith("http"))&&(console.log("Maqro: Injecting content script into tab",o),chrome.scripting.executeScript({target:{tabId:o},files:["content.js"]}).then((()=>{console.log("Maqro: Content script injected successfully"),chrome.tabs.sendMessage(o,{type:"TOGGLE_COLLECTION",enabled:e.isCollecting})})).catch((e=>{console.error("Maqro: Error injecting content script",e)})))})),chrome.action.onClicked.addListener((o=>{o.id&&(chrome.tabs.sendMessage(o.id,{type:"TOGGLE_COLLECTION",enabled:!e.isCollecting}),e.isCollecting=!e.isCollecting)})),chrome.idle.onStateChanged.addListener((o=>{console.log("Maqro: Idle state changed to",o),"idle"===o?e.isCollecting=!1:"active"===o&&(e.isCollecting=!0)})),chrome.windows.onFocusChanged.addListener((o=>{console.log("Maqro: Window focus changed to",o),o===chrome.windows.WINDOW_ID_NONE?e.isCollecting=!1:e.isCollecting=!0}))})();
//# sourceMappingURL=background.js.map